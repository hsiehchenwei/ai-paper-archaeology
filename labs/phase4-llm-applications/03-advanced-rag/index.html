<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4.3 é€²éš RAG - å„ªåŒ–æª¢ç´¢å“è³ª | AI å¯¦é©— Playground</title>
    <!-- Playful Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700;800;900&family=Nunito:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../../../styles/global.css" />
    <link rel="stylesheet" href="../../../styles/paper-reading.css" />
    <link rel="stylesheet" href="../../../styles/labs.css" />
    <style>
      body {
        font-family: "Nunito", sans-serif;
      }
      h1, h2, h3, h4, .phase-link {
        font-family: "Fredoka", sans-serif;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Step Navigation -->
      <div class="lab-steps">
        <a href="../index.html" class="lab-step">â† Phase 4</a>
        <a href="#step1" class="lab-step active">Step 1: ç‚ºä»€éº¼è¦é€²éšï¼Ÿ</a>
        <a href="#step2" class="lab-step">Step 2: Hybrid Search</a>
        <a href="#step3" class="lab-step">Step 3: Reranking</a>
        <a href="#step4" class="lab-step">Step 4: å¯¦ä½œæ¯”è¼ƒ</a>
      </div>

      <!-- Main Content -->
      <div class="story-container">
        <h1>ğŸš€ 4.3 é€²éš RAG - å¾ã€Œèƒ½ç”¨ã€åˆ°ã€Œå¥½ç”¨ã€</h1>
        <p class="lab-intro-text">
          åŸºç¤ RAG æœ‰æ™‚æœƒæ‰¾éŒ¯è³‡è¨Šï¼Œç‰¹åˆ¥æ˜¯ç•¶å•é¡ŒåŒ…å«å°ˆæ¥­è¡“èªæˆ–ç‰¹å®šåç¨±æ™‚ã€‚
          åœ¨é€™å€‹å¯¦é©—ä¸­ï¼Œæˆ‘å€‘å°‡å»¶çºŒ 4.2 ä½¿ç”¨ <strong>LlamaIndex</strong>ï¼Œå­¸ç¿’å¦‚ä½•å¯¦ä½œ<strong>æ··åˆæœå°‹ (Hybrid Search)</strong>
          ä»¥åŠ<strong>é‡æ’åº (Reranking)</strong>ï¼Œé€™èƒ½é¡¯è‘—æå‡ç¹é«”ä¸­æ–‡ç’°å¢ƒä¸‹çš„æª¢ç´¢ç²¾æº–åº¦ã€‚
        </p>

        <!-- Step 1: ç‚ºä»€éº¼è¦é€²éšï¼Ÿ -->
        <section id="step1" class="lab-section">
          <h2>ğŸ“ Step 1: å‘é‡æœå°‹çš„ä¾·é™æ€§</h2>
          <p>
            å‘é‡æœå°‹ (Semantic Search) å¾ˆå¼·ï¼Œä½†æœ‰æ™‚æœƒã€Œæƒ³å¤ªå¤šã€ã€‚
            ä¾‹å¦‚æœå°‹ "Transformer"ï¼Œå®ƒå¯èƒ½æœƒæ‰¾å›å¾ˆå¤šé—œæ–¼ "Attention" çš„å…§å®¹ï¼Œä½†æ¼æ‰äº†ä¸€ç¯‡åŒ…å« "Transformer" é—œéµå­—ä½†èªç¾©ç•¥æœ‰åå·®çš„æ–‡ç« ã€‚
          </p>
          <div class="visual-diagram">
            <h4>ğŸ’¡ è§£æ±ºæ–¹æ¡ˆï¼šæ··åˆæœå°‹</h4>
            <pre>
æ··åˆæœå°‹ = èªç¾©æœå°‹ (Embedding) + é—œéµå­—æœå°‹ (BM25)
            </pre>
          </div>
        </section>

        <!-- Step 2: ä¸­æ–‡ Hybrid Search -->
        <section id="step2" class="lab-section">
          <h2>ğŸŒ Step 2: ä¸­æ–‡ Hybrid Search å¯¦ä½œ</h2>
          <p>
            åœ¨ä¸­æ–‡ç’°å¢ƒä¸‹ï¼Œé—œéµå­—æœå°‹éœ€è¦å…ˆé€²è¡Œã€Œåˆ†è©ã€ã€‚æˆ‘å€‘å°‡ä½¿ç”¨ <code>jieba</code> é€²è¡Œç¹é«”ä¸­æ–‡åˆ†è©ã€‚
          </p>
          
          <div class="lab-setup" style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h4>ğŸ“Š Hybrid Search åŸç†</h4>
            <pre style="background: #fff; padding: 15px; border-radius: 6px; color: #1f2937; line-height: 1.6;">
æ··åˆæœå°‹ = èªç¾©æœå°‹ (Embedding) + é—œéµå­—æœå°‹ (BM25)

ç¯„ä¾‹ï¼šæŸ¥è©¢ã€ŒTransformer çš„ä½ç½®ç·¨ç¢¼ã€
- èªç¾©æœå°‹ï¼šæ‰¾åˆ°èªç¾©ç›¸é—œçš„å…§å®¹ï¼ˆå³ä½¿æ²’æœ‰é—œéµå­—ï¼‰
- é—œéµå­—æœå°‹ï¼šç¢ºä¿åŒ…å« "Transformer" å’Œ "ä½ç½®ç·¨ç¢¼" çš„æ®µè½å„ªå…ˆ
- çµåˆçµæœï¼šæå‡æº–ç¢ºç‡ 15-25%ï¼ˆç ”ç©¶æ•¸æ“šï¼‰
            </pre>
          </div>
          
          <div class="ai-prompt-block">
            <p>è¤‡è£½ Prompt å¯¦ä½œ Hybrid Searchï¼š</p>
            <pre>
è«‹å¹«æˆ‘æ’°å¯«ä¸€å€‹ Python è…³æœ¬ä½¿ç”¨ LlamaIndex + Qdrant å¯¦ä½œ Hybrid Searchï¼š
1. å®‰è£å¥—ä»¶ï¼šllama-index, llama-index-vector-stores-qdrant, fastembed, jieba
2. å•Ÿå‹• Qdrantï¼ˆä½¿ç”¨ Docker æˆ–æœ¬åœ°é‹è¡Œï¼‰ï¼š
   docker run -p 6333:6333 qdrant/qdrant
3. ä½¿ç”¨ Qdrant ä½œç‚ºå‘é‡è³‡æ–™åº«ï¼ˆæ”¯æ´ Hybrid Searchï¼‰ï¼š
   from llama_index.vector_stores.qdrant import QdrantVectorStore
   from qdrant_client import QdrantClient
   
   client = QdrantClient(host="localhost", port=6333)
   vector_store = QdrantVectorStore(
       collection_name="chinese_docs",
       client=client,
       enable_hybrid=True,                    # ğŸ¯ å•Ÿç”¨ Hybrid Searchï¼ˆä¸€è¡Œæå®šï¼ï¼‰
       fastembed_sparse_model="Qdrant/bm25", # ä½¿ç”¨ BM25 ç¨€ç–å‘é‡
       batch_size=20
   )
4. è¼‰å…¥ç¹é«”ä¸­æ–‡æ–‡æª”ï¼Œä½¿ç”¨ jieba é€²è¡Œåˆ†è©é è™•ç†ï¼ˆç”¨æ–¼æ”¹å–„ä¸­æ–‡ BM25 æ•ˆæœï¼‰
5. å»ºç«‹ç´¢å¼•ä¸¦é…ç½® hybrid æŸ¥è©¢æ¨¡å¼ï¼š
   query_engine = index.as_query_engine(
       similarity_top_k=3,           # æœ€çµ‚è¿”å› 3 å€‹çµæœ
       sparse_top_k=10,              # Dense + Sparse å„æª¢ç´¢ 10 å€‹
       vector_store_query_mode="hybrid"  # å•Ÿç”¨æ··åˆæ¨¡å¼
   )
6. æ¸¬è©¦æŸ¥è©¢ï¼šã€ŒTransformer çš„ä½ç½®ç·¨ç¢¼ã€
7. å°æ¯”ä¸‰ç¨®æ¨¡å¼çš„çµæœå·®ç•°ï¼š
   - vector_store_query_mode="default"ï¼ˆç´”å‘é‡ï¼‰
   - vector_store_query_mode="hybrid"ï¼ˆæ··åˆï¼‰
   - ä¸¦é¡¯ç¤ºæ¯å€‹çµæœçš„ score
8. åŠ å…¥è©³ç´°è¨»è§£èªªæ˜æ¯å€‹æ­¥é©Ÿ

åƒè€ƒæ–‡æª”ï¼šhttps://docs.llamaindex.ai/en/stable/examples/vector_stores/qdrant_hybrid/
            </pre>
            <button class="ai-prompt-copy-btn" onclick="copyPrompt(this)">ğŸ“‹ è¤‡è£½ Prompt</button>
          </div>
          
          <div class="lab-setup" style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b; margin-top: 20px;">
            <h4>âš¡ æ•ˆèƒ½æå‡æ•¸æ“š</h4>
            <p>æ ¹æ“šå¤šé …ç ”ç©¶ï¼ˆåƒè€ƒ MTEB Benchmarkï¼‰ï¼ŒHybrid Search ç›¸è¼ƒæ–¼å–®ç´”å‘é‡æœå°‹ï¼š</p>
            <ul>
              <li>âœ… æª¢ç´¢æº–ç¢ºç‡æå‡ï¼š<strong>15-25%</strong></li>
              <li>âœ… ç‰¹åˆ¥é©åˆï¼šå°ˆæœ‰åè©ã€æŠ€è¡“è¡“èªã€ç”¢å“å‹è™Ÿ</li>
              <li>âš ï¸ å»¶é²å¢åŠ ï¼šç´„ 20-50msï¼ˆå¯æ¥å—ç¯„åœï¼‰</li>
            </ul>
            <p style="margin-top: 15px; padding: 12px; background: #fff; border-radius: 6px; font-size: 0.95rem;">
              <strong>ğŸ’¡ ç‚ºä»€éº¼é¸æ“‡ Qdrantï¼Ÿ</strong><br>
              â€¢ <strong>æ¥µç°¡æ•´åˆï¼š</strong><code>enable_hybrid=True</code> ä¸€è¡Œå•Ÿç”¨<br>
              â€¢ <strong>å­¸ç¿’é€£è²«ï¼š</strong>å»¶çºŒ 4.1 å¯¦é©—ä½¿ç”¨çš„å‘é‡è³‡æ–™åº«<br>
              â€¢ <strong>æ•ˆèƒ½å„ªç•°ï¼š</strong>Sub-10ms latencyï¼Œé©åˆç”Ÿç”¢ç’°å¢ƒ<br>
              â€¢ <strong>LlamaIndex å®˜æ–¹æ”¯æ´ï¼š</strong>å®Œæ•´æ–‡æª”èˆ‡ç¯„ä¾‹
            </p>
          </div>
        </section>

        <!-- Step 3: Reranking -->
        <section id="step3" class="lab-section">
          <h2>ğŸ¯ Step 3: ä½¿ç”¨ Reranker æ¨¡å‹äºŒæ¬¡ç²¾ç…‰</h2>
          <p>
            æª¢ç´¢å™¨å¯èƒ½å›å‚³å‰ 20 å€‹çµæœï¼Œä½†å…¶ä¸­åªæœ‰ 3 å€‹æ˜¯çœŸçš„æœ‰ç”¨çš„ã€‚
            <strong>Reranker æ¨¡å‹</strong>èƒ½é‡æ–°è¨ˆç®—å•é¡Œèˆ‡æ¯å€‹çµæœçš„ç›¸é—œæ€§ï¼Œå°‡æœ€ç²¾æº–çš„å…§å®¹æ’åœ¨æœ€å‰é¢ã€‚
          </p>
          
          <div class="lab-setup" style="background: #f0f9ff; padding: 20px; border-radius: 8px; border-left: 4px solid #3b82f6; margin-bottom: 20px;">
            <h4>ğŸ”¬ Reranker çš„æŠ€è¡“åŸç†</h4>
            <p style="margin-bottom: 15px;">
              <strong>Reranker æ˜¯ä¸€ç¨®ç‰¹æ®Šçš„ Transformer æ¶æ§‹</strong>ï¼Œç¨±ç‚º <strong>Cross-Encoder</strong>ï¼ˆäº¤å‰ç·¨ç¢¼å™¨ï¼‰ï¼Œ
              èˆ‡ä¸€èˆ¬çš„ Embedding æ¨¡å‹ï¼ˆBi-Encoderï¼‰æœ‰æœ¬è³ªä¸Šçš„ä¸åŒï¼š
            </p>
            
            <table style="width: 100%; border-collapse: collapse; background: #fff; font-size: 0.9rem; margin-bottom: 15px;">
              <thead>
                <tr style="background: #f3f4f6;">
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">ç‰¹æ€§</th>
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">Bi-Encoderï¼ˆEmbedding æ¨¡å‹ï¼‰</th>
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">Cross-Encoderï¼ˆRerankerï¼‰</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>è™•ç†æ–¹å¼</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">å•é¡Œå’Œæ–‡æª”<strong>åˆ†åˆ¥</strong>ç·¨ç¢¼</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">å•é¡Œå’Œæ–‡æª”<strong>ä¸€èµ·</strong>ç·¨ç¢¼</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>è¼¸å…¥æ ¼å¼</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><code>encode(query)</code><br><code>encode(doc)</code></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><code>encode([query, doc])</code><br>é€£æ¥å¾Œä¸€èµ·è™•ç†</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>è¼¸å‡º</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">å‘é‡ï¼ˆ768/1024 ç¶­ï¼‰<br>ç”¨ç›¸ä¼¼åº¦æ¯”è¼ƒ</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">ç›¸é—œæ€§åˆ†æ•¸ï¼ˆ0-1ï¼‰<br>ç›´æ¥åˆ¤æ–·ç›¸é—œç¨‹åº¦</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>è¨ˆç®—æ•ˆç‡</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">âš¡ æ¥µå¿«<br>æ–‡æª”å¯é å…ˆè¨ˆç®—</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">â±ï¸ è¼ƒæ…¢<br>æ¯å€‹ query-doc å°éƒ½è¦é‡ç®—</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>æº–ç¢ºç‡</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">è‰¯å¥½</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">âœ… æ¥µä½³ï¼ˆæå‡ 10-15%ï¼‰</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>é©ç”¨éšæ®µ</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">ç¬¬ä¸€éšæ®µï¼šåˆæ­¥æª¢ç´¢</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">ç¬¬äºŒéšæ®µï¼šç²¾ç…‰æ’åº</td>
                </tr>
              </tbody>
            </table>
            
            <div style="padding: 15px; background: #fff; border-radius: 6px; margin-bottom: 15px;">
              <strong>ğŸ”‘ é—œéµå·®ç•°ï¼šSelf-Attention çš„ä½œç”¨ç¯„åœ</strong>
              <ul style="margin-top: 10px;">
                <li><strong>Bi-Encoderï¼š</strong>å•é¡Œå’Œæ–‡æª”çš„ tokens ç„¡æ³•äº’ç›¸çœ‹åˆ°å°æ–¹ï¼Œåªèƒ½äº‹å¾Œæ¯”è¼ƒå‘é‡ç›¸ä¼¼åº¦</li>
                <li><strong>Cross-Encoderï¼š</strong>å•é¡Œå’Œæ–‡æª”çš„æ‰€æœ‰ tokens å¯ä»¥äº’ç›¸é—œæ³¨ï¼ˆcross-attentionï¼‰ï¼Œèƒ½æ•æ‰æ›´ç´°ç·»çš„èªç¾©é—œä¿‚</li>
              </ul>
            </div>
            
            <p style="padding: 15px; background: #ecfdf5; border-radius: 6px; border-left: 3px solid #10b981; font-size: 0.95rem;">
              <strong>ğŸ’¡ æ¶æ§‹åŸºç¤ï¼š</strong><br>
              â€¢ <strong>BGE-Rerankerï¼š</strong>åŸºæ–¼ XLM-RoBERTaï¼ˆBERT çš„å¤šèªè¨€ç‰ˆæœ¬ï¼‰<br>
              â€¢ <strong>ä¸æ˜¯ GPT é¢¨æ ¼ï¼š</strong>ä¸æ˜¯ç”Ÿæˆå¼æ¨¡å‹ï¼Œè€Œæ˜¯å°ˆé–€è¨“ç·´ç”¨æ–¼ã€Œåˆ¤æ–·ç›¸é—œæ€§ã€çš„åˆ†é¡æ¨¡å‹<br>
              â€¢ <strong>è¨“ç·´æ•¸æ“šï¼š</strong>ä½¿ç”¨å¤§é‡ (query, document, relevance_score) ä¸‰å…ƒçµ„é€²è¡Œç›£ç£å­¸ç¿’
            </p>
          </div>
          
          <div class="lab-setup" style="background: #fef3c7; padding: 20px; border-radius: 8px; border-left: 4px solid #f59e0b; margin-bottom: 20px;">
            <h4>ğŸ¤” å¯ä»¥ç”¨ GPT ä½œç‚º Reranker å—ï¼Ÿ</h4>
            <p style="margin-bottom: 15px;">
              <strong>æŠ€è¡“ä¸Šå¯ä»¥ï¼Œä½†ä¸æ¨è–¦ã€‚</strong>æ ¹æ“š 2024 å¹´çš„ç ”ç©¶å°æ¯”ï¼ˆarXiv:2403.10407ï¼‰ï¼š
            </p>
            
            <table style="width: 100%; border-collapse: collapse; background: #fff; font-size: 0.9rem; margin-bottom: 15px;">
              <thead>
                <tr style="background: #f3f4f6;">
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">æŒ‡æ¨™</th>
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">GPT-4 Reranker</th>
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">Cross-Encoder<br>(DeBERTa-Large)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>æº–ç¢ºç‡ï¼ˆnDCG@10ï¼‰</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">è‰¯å¥½ï¼ˆé›¶æ¨£æœ¬èƒ½åŠ›å¼·ï¼‰</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">âœ… 0.689ï¼ˆTREC DL 2019ï¼‰<br>æŒå¹³æˆ–æ›´å„ª</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>å»¶é²</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">âŒ æ¥µé«˜ï¼ˆæ•¸ç§’ï¼‰</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">âœ… ä½ï¼ˆ50-200msï¼‰</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>æˆæœ¬</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">âŒ æ¥µé«˜ï¼ˆæ¯æ¬¡ API èª¿ç”¨ï¼‰</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">âœ… ä½ï¼ˆæœ¬åœ°é‹è¡Œï¼‰</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>å¯æ“´å±•æ€§</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">âŒ å·®ï¼ˆå— API é™åˆ¶ï¼‰</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">âœ… å„ªï¼ˆå¯æ‰¹æ¬¡è™•ç†ï¼‰</td>
                </tr>
              </tbody>
            </table>
            
            <p style="padding: 12px; background: #fff; border-radius: 6px; font-size: 0.95rem;">
              <strong>âš ï¸ çµè«–ï¼š</strong>GPT-4 åœ¨é›¶æ¨£æœ¬ reranking ä¸Šè¡¨ç¾ä¸éŒ¯ï¼Œä½†<strong>å°ˆé–€çš„ Cross-Encoder æ›´é«˜æ•ˆ</strong>ã€‚
              åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼ŒCross-Encoder æä¾›äº†ã€Œæ•ˆèƒ½ã€æˆæœ¬ã€å»¶é²ã€çš„æœ€ä½³å¹³è¡¡ã€‚
            </p>
          </div>
          
          <div class="lab-setup">
            <h4>ğŸ’¡ ä¸­æ–‡ Reranker å»ºè­°</h4>
            <ul>
              <li><strong>BGE-Reranker-v2-m3:</strong> BAAI é–‹ç™¼ï¼ŒåŸºæ–¼ XLM-RoBERTaï¼Œå°ä¸­æ–‡æ”¯æŒæ¥µä½³ï¼Œé–‹æºå…è²»</li>
              <li><strong>Cohere Rerank:</strong> å•†æ¥­æœå‹™ï¼ŒCross-Encoder æ¶æ§‹ï¼Œæ”¯æ´å¤šèªè¨€ï¼ŒAPI èª¿ç”¨æ–¹ä¾¿</li>
              <li><strong>bge-reranker-large:</strong> è¼ƒå¤§çš„ Cross-Encoder æ¨¡å‹ï¼Œæº–ç¢ºç‡æ›´é«˜ä½†é€Ÿåº¦è¼ƒæ…¢</li>
            </ul>
            <p style="margin-top: 15px; padding: 12px; background: #ecfdf5; border-radius: 6px; border-left: 3px solid #10b981; font-size: 0.95rem;">
              <strong>ğŸ“Š Reranking æ•ˆèƒ½æå‡ï¼š</strong>æ ¹æ“šç ”ç©¶ï¼Œåœ¨ Hybrid Search åŸºç¤ä¸ŠåŠ å…¥ Rerankingï¼Œ
              å¯å†æå‡ <strong>10-15%</strong> çš„æº–ç¢ºç‡ï¼Œç‰¹åˆ¥é©åˆè¤‡é›œæŸ¥è©¢ã€‚
            </p>
            <p style="margin-top: 10px; font-size: 0.9rem; color: #6b7280;">
              <strong>ğŸ“š ç›¸é—œè«–æ–‡ï¼š</strong><br>
              â€¢ BGE-M3: <a href="https://arxiv.org/abs/2402.03216" target="_blank">arxiv.org/abs/2402.03216</a><br>
              â€¢ Cross-Encoder vs GPT: <a href="https://arxiv.org/abs/2403.10407" target="_blank">arxiv.org/abs/2403.10407</a><br>
              â€¢ BGE Reranker æ–‡æª”: <a href="https://bge-model.com/bge/bge_reranker.html" target="_blank">bge-model.com</a>
            </p>
          </div>
          
          <div class="ai-prompt-block">
            <p>è¤‡è£½ Prompt åŠ å…¥ Rerankingï¼š</p>
            <pre>
ä¿®æ”¹ä¹‹å‰çš„ LlamaIndex è…³æœ¬ï¼ŒåŠ å…¥ Reranking æ­¥é©Ÿï¼š
1. å®‰è£å¥—ä»¶ï¼šllama-index-postprocessor-cohere, llama-index-postprocessor-sentence-transformer
2. é¸æ“‡ Rerankerï¼ˆäºŒé¸ä¸€ï¼‰ï¼š
   
   æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ Cohere Rerank APIï¼ˆå•†æ¥­ï¼Œéœ€ API Keyï¼‰
   from llama_index.postprocessor.cohere_rerank import CohereRerank
   reranker = CohereRerank(
       top_n=3,
       model="rerank-multilingual-v3.0",
       api_key="YOUR_COHERE_API_KEY"
   )
   
   æ–¹æ¡ˆäºŒï¼šä½¿ç”¨é–‹æº BGE Rerankerï¼ˆå…è²»ï¼Œæœ¬åœ°é‹è¡Œï¼‰
   from llama_index.core.postprocessor import SentenceTransformerRerank
   reranker = SentenceTransformerRerank(
       model="BAAI/bge-reranker-v2-m3",
       top_n=3
   )
3. å°‡ reranker åŠ å…¥æŸ¥è©¢å¼•æ“ï¼š
   query_engine = index.as_query_engine(
       vector_store_query_mode="hybrid",
       similarity_top_k=10,  # å…ˆæª¢ç´¢ 10 å€‹
       node_postprocessors=[reranker]  # Rerank å¾Œä¿ç•™å‰ 3 å€‹
   )
4. æ¸¬è©¦è¤‡é›œæŸ¥è©¢ï¼šã€Œæ¯”è¼ƒ Transformer å’Œ RNN åœ¨è™•ç†é•·åºåˆ—æ™‚çš„å„ªç¼ºé»ã€
5. åŠ å…¥è¨ˆæ™‚åŠŸèƒ½ï¼Œå°æ¯”ä»¥ä¸‹ä¸‰ç¨®æ¨¡å¼çš„å»¶é²èˆ‡æº–ç¢ºç‡ï¼š
   - Vector Only
   - Hybrid Search
   - Hybrid Search + Reranking
6. è¼¸å‡ºå‰ 3 å€‹çµæœçš„å…§å®¹æ‘˜è¦å’Œç›¸é—œæ€§åˆ†æ•¸

åƒè€ƒæ–‡æª”ï¼šhttps://docs.llamaindex.ai/en/stable/module_guides/querying/node_postprocessors/
            </pre>
            <button class="ai-prompt-copy-btn" onclick="copyPrompt(this)">ğŸ“‹ è¤‡è£½ Prompt</button>
          </div>
          
          <div class="lab-setup" style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b; margin-top: 20px;">
            <h4>âš–ï¸ Reranker é¸æ“‡å»ºè­°</h4>
            <table style="width: 100%; border-collapse: collapse; background: #fff; font-size: 0.9rem; margin-top: 10px;">
              <thead>
                <tr style="background: #f3f4f6;">
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">æ¨¡å‹</th>
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">å„ªé»</th>
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">ç¼ºé»</th>
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">é©ç”¨å ´æ™¯</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Cohere Rerank</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">â€¢ API èª¿ç”¨ç°¡å–®<br>â€¢ å»¶é²ä½ (~50ms)<br>â€¢ å¤šèªè¨€æ”¯æ´</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">â€¢ éœ€ä»˜è²»<br>â€¢ è³‡æ–™å¤–å‚³</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">å¿«é€ŸåŸå‹ã€é ç®—å……è¶³</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>BGE-Reranker-v2-m3</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">â€¢ é–‹æºå…è²»<br>â€¢ æœ¬åœ°é‹è¡Œ<br>â€¢ ä¸­æ–‡æ•ˆæœå¥½</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">â€¢ éœ€ GPU åŠ é€Ÿ<br>â€¢ å»¶é²è¼ƒé«˜ (~200ms)</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">ç”Ÿç”¢ç’°å¢ƒã€éš±ç§å„ªå…ˆ</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>bge-reranker-large</strong></td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">â€¢ æº–ç¢ºç‡æœ€é«˜<br>â€¢ é–‹æºå…è²»</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">â€¢ å»¶é²æœ€é«˜ (~300ms)<br>â€¢ éœ€æ›´å¤š GPU è¨˜æ†¶é«”</td>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;">é›¢ç·šè™•ç†ã€é«˜æº–ç¢ºç‡éœ€æ±‚</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="lab-setup" style="background: #f0f9ff; padding: 20px; border-radius: 8px; border-left: 4px solid #3b82f6; margin-top: 20px;">
            <h4>ğŸ’» BGE Reranker ç¡¬é«”éœ€æ±‚èˆ‡æ•ˆèƒ½</h4>
            <p style="margin-bottom: 15px;">
              ä»¥ä¸‹æ˜¯ä¸‰å€‹ BGE Reranker æ¨¡å‹çš„è©³ç´°è¦æ ¼å°æ¯”ï¼š
            </p>
            
            <table style="width: 100%; border-collapse: collapse; background: #fff; font-size: 0.9rem; margin-bottom: 20px;">
              <thead>
                <tr style="background: #f3f4f6;">
                  <th style="padding: 10px; text-align: left; border: 1px solid #e5e7eb;">æ¨¡å‹</th>
                  <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">åƒæ•¸é‡</th>
                  <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">æ¨¡å‹å¤§å°</th>
                  <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">æ¨ç†é€Ÿåº¦<br>(å–®æ¬¡)</th>
                  <th style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">æ‰¹æ¬¡è™•ç†<br>(per query)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>bge-reranker-base</strong></td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">278M</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">~1.1 GB</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">å¿«</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">-</td>
                </tr>
                <tr style="background: #ecfdf5;">
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>bge-reranker-v2-m3</strong><br>â­ æ¨è–¦</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">568M</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">2.27 GB</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">25-30ms<br>(FP16)</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">15ms<br>(batch=64)</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>bge-reranker-large</strong></td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">560M</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">~2.2 GB</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">120-150ms<br>(FP32)</td>
                  <td style="padding: 10px; text-align: center; border: 1px solid #e5e7eb;">80ms<br>(batch=16)</td>
                </tr>
              </tbody>
            </table>
            
            <div style="padding: 15px; background: #fff; border-radius: 6px; margin-bottom: 15px;">
              <strong>ğŸ–¥ï¸ ç¡¬é«”éœ€æ±‚ï¼ˆä»¥ bge-reranker-v2-m3 ç‚ºä¾‹ï¼‰ï¼š</strong>
              <ul style="margin-top: 10px;">
                <li><strong>æœ€ä½é…ç½®ï¼ˆGPUï¼‰ï¼š</strong>
                  <ul style="margin-top: 5px; margin-left: 20px;">
                    <li>GPUï¼šNVIDIA GTX 1050 Ti æˆ–ä»¥ä¸Šï¼ˆ4GB VRAMï¼‰</li>
                    <li>RAMï¼š16GB ç³»çµ±è¨˜æ†¶é«”</li>
                    <li>å»¶é²ï¼šç´„ 200-300msï¼ˆå° batchï¼‰</li>
                  </ul>
                </li>
                <li style="margin-top: 10px;"><strong>æ¨è–¦é…ç½®ï¼ˆGPUï¼‰ï¼š</strong>
                  <ul style="margin-top: 5px; margin-left: 20px;">
                    <li>GPUï¼šNVIDIA RTX 3060 æˆ–ä»¥ä¸Šï¼ˆ12GB VRAMï¼‰</li>
                    <li>RAMï¼š16GB ç³»çµ±è¨˜æ†¶é«”</li>
                    <li>å»¶é²ï¼šç´„ 50-100msï¼ˆä¸­ç­‰ batchï¼‰</li>
                  </ul>
                </li>
                <li style="margin-top: 10px;"><strong>é«˜æ•ˆé…ç½®ï¼ˆGPUï¼‰ï¼š</strong>
                  <ul style="margin-top: 5px; margin-left: 20px;">
                    <li>GPUï¼šNVIDIA A100 40GB æˆ– RTX 4090ï¼ˆ24GB VRAMï¼‰</li>
                    <li>RAMï¼š32GB ç³»çµ±è¨˜æ†¶é«”</li>
                    <li>å»¶é²ï¼šç´„ 25-30msï¼ˆå¤§ batchï¼ŒFP16ï¼‰</li>
                  </ul>
                </li>
                <li style="margin-top: 10px;"><strong>âš ï¸ CPU æ¨¡å¼ï¼ˆä¸æ¨è–¦ï¼‰ï¼š</strong>
                  <ul style="margin-top: 5px; margin-left: 20px;">
                    <li>å»¶é²ï¼šç´„ 2-3 ç§’ï¼ˆéå¸¸æ…¢ï¼‰</li>
                    <li>CPU è¨˜æ†¶é«”ï¼šç´„ 11GB</li>
                    <li>é©ç”¨ï¼šæ¸¬è©¦ã€å°è¦æ¨¡åŸå‹</li>
                  </ul>
                </li>
              </ul>
            </div>
            
            <div style="padding: 15px; background: #ecfdf5; border-radius: 6px; border-left: 3px solid #10b981;">
              <strong>ğŸ’¡ å¯¦éš›ä½¿ç”¨å»ºè­°ï¼š</strong>
              <ul style="margin-top: 10px;">
                <li><strong>å­¸ç¿’èˆ‡åŸå‹éšæ®µï¼š</strong>å¯ä»¥ç”¨ CPU æ¨¡å¼ï¼Œé›–ç„¶æ…¢ä½†å¯ä»¥é‹è¡Œ</li>
                <li><strong>é–‹ç™¼æ¸¬è©¦éšæ®µï¼š</strong>ä½¿ç”¨å…¥é–€ç´š GPUï¼ˆGTX 1050 Ti ä»¥ä¸Šï¼‰ï¼Œå»¶é²ç´„ 200ms</li>
                <li><strong>ç”Ÿç”¢ç’°å¢ƒï¼š</strong>å»ºè­° RTX 3060 ä»¥ä¸Šï¼Œé…åˆæ‰¹æ¬¡è™•ç†ï¼Œå¹³å‡å»¶é²å¯é™è‡³ 50-100ms</li>
                <li><strong>é«˜ååå ´æ™¯ï¼š</strong>ä½¿ç”¨ A100/RTX 4090 + å¤§ batch sizeï¼Œå¯é” 15-30ms/query</li>
                <li><strong>å„ªåŒ–æŠ€å·§ï¼š</strong>ä½¿ç”¨ FP16 ç²¾åº¦ï¼ˆåŠç²¾åº¦ï¼‰å¯æ¸›å°‘ç´„ 50% è¨˜æ†¶é«”ä½¿ç”¨å’Œå»¶é²</li>
              </ul>
            </div>
            
            <p style="margin-top: 15px; padding: 12px; background: #fff; border-radius: 6px; font-size: 0.95rem;">
              <strong>âš–ï¸ æ¬Šè¡¡ï¼š</strong>ç›¸è¼ƒæ–¼ Cohere Rerank APIï¼ˆ50msï¼Œ$1/1000 requestsï¼‰ï¼Œ
              BGE Reranker åœ¨<strong>æ¶ˆè²»ç´š GPU</strong>ï¼ˆRTX 3060ï¼‰ä¸Šçš„å»¶é²ç´„ <strong>50-100ms</strong>ï¼Œ
              ä½†å®Œå…¨å…è²»ä¸”è³‡æ–™ä¸å¤–å‚³ã€‚å¦‚æœä½ æœ‰ GPUï¼Œ<strong>BGE Reranker æ˜¯æ›´å¥½çš„é•·æœŸé¸æ“‡</strong>ã€‚
            </p>
          </div>
        </section>

        <!-- Step 4: å¯¦ä½œæ¯”è¼ƒ -->
        <section id="step4" class="lab-section">
          <h2>ğŸ“Š Step 4: æ•ˆèƒ½å°æ¯”å¯¦é©—</h2>
          <p>è®“æˆ‘å€‘ä¾†çœ‹çœ‹é€²éšæŠ€è¡“çš„æ•ˆæœå¦‚ä½•ã€‚</p>
          
          <div class="lab-setup" style="background: #fef3c7; padding: 20px; border-radius: 8px; border-left: 4px solid #f59e0b; margin-bottom: 20px;">
            <h4>ğŸ”¬ å¯¦é©—è¨­è¨ˆï¼šChunk Size å½±éŸ¿æ¸¬è©¦</h4>
            <p style="margin-bottom: 15px;">
              åœ¨å°æ¯”ä¸åŒæª¢ç´¢æ¨¡å¼æ™‚ï¼Œä¹Ÿè¦æ¸¬è©¦ä¸åŒçš„ chunk sizeã€‚æ ¹æ“šç ”ç©¶ï¼ˆ<strong>NVIDIA 2024 Benchmark</strong>ï¼‰ï¼Œ
              chunk size å°æ•ˆèƒ½çš„å½±éŸ¿å¯èƒ½æ¯”æª¢ç´¢ç­–ç•¥æœ¬èº«æ›´å¤§ï¼
            </p>
            <p style="padding: 12px; background: #fff; border-radius: 6px; font-size: 0.95rem;">
              <strong>å»ºè­°æ¸¬è©¦çµ„åˆï¼š</strong><br>
              â€¢ Chunk Size: 256, 512, 1024 tokens<br>
              â€¢ æª¢ç´¢ç­–ç•¥: Vector Only, Hybrid, Hybrid + Reranking<br>
              â€¢ æ¸¬è©¦å•é¡Œ: çŸ­å•ç­”ã€æŠ€è¡“æè¿°ã€è¤‡é›œæ¨ç†
            </p>
          </div>
          
          <div class="ai-prompt-block">
            <pre>
è«‹å»ºç«‹ä¸€å€‹å®Œæ•´çš„æ¸¬è©¦è…³æœ¬ï¼Œå°æ¯”ä¸åŒé…ç½®ï¼š
1. æº–å‚™ä¸‰ç¨® chunk size çš„ç‰ˆæœ¬ï¼ˆ256, 512, 1024 tokensï¼‰
2. å°æ¯å€‹ç‰ˆæœ¬æ¸¬è©¦ä¸‰ç¨®æª¢ç´¢æ¨¡å¼ï¼š
   - å–®ç´”å‘é‡æœå°‹ (Vector Only)
   - æ··åˆæœå°‹ (Hybrid Search)
   - æ··åˆæœå°‹ + Reranking
3. æ¸¬è©¦ 5 å€‹ä¸åŒé¡å‹çš„ä¸­æ–‡å•é¡Œï¼š
   - çŸ­å•ç­”ï¼šã€ŒTransformer æ˜¯ä»€éº¼ï¼Ÿã€
   - æŠ€è¡“æè¿°ï¼šã€Œè§£é‡‹ Self-Attention çš„é‹ä½œåŸç†ã€
   - è¤‡é›œæ¨ç†ï¼šã€Œæ¯”è¼ƒ BERT å’Œ GPT çš„ç•°åŒã€
4. è¨˜éŒ„æŒ‡æ¨™ï¼š
   - æª¢ç´¢æº–ç¢ºç‡ï¼ˆå‰ 3 å€‹çµæœä¸­æ˜¯å¦åŒ…å«ç­”æ¡ˆï¼‰
   - æª¢ç´¢æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
   - Token æˆæœ¬ï¼ˆæ¯æ¬¡æŸ¥è©¢ä½¿ç”¨çš„ç¸½ tokensï¼‰
5. ä»¥è¡¨æ ¼å½¢å¼è¼¸å‡ºçµæœï¼Œä¸¦çµ¦å‡ºæœ€ä½³é…ç½®å»ºè­°ã€‚
            </pre>
            <button class="ai-prompt-copy-btn" onclick="copyPrompt(this)">ğŸ“‹ è¤‡è£½ Prompt</button>
          </div>
          
          <div class="lab-setup" style="background: #ecfdf5; padding: 20px; border-radius: 8px; border-left: 4px solid #10b981; margin-top: 20px;">
            <h4>ğŸ“š ç›¸é—œç ”ç©¶è«–æ–‡</h4>
            <ul>
              <li><a href="https://arxiv.org/abs/2505.21700" target="_blank">Rethinking Chunk Size For Long-Document Retrieval (2024)</a> - ç³»çµ±æ€§è©•ä¼°ä¸åŒ chunk size çš„æ•ˆèƒ½</li>
              <li><a href="https://arxiv.org/abs/2406.15319" target="_blank">LongRAG: Enhancing Retrieval with Long-context (2024)</a> - ä½¿ç”¨ 4K token chunks çš„å‰µæ–°æ–¹æ³•</li>
              <li><a href="https://arxiv.org/abs/2410.12788" target="_blank">Meta-Chunking: Learning Efficient Text Segmentation (2024)</a> - å‹•æ…‹åˆ†å¡Šç­–ç•¥</li>
              <li><a href="https://developer.nvidia.com/blog/finding-the-best-chunking-strategy-for-accurate-ai-responses/" target="_blank">NVIDIA: Best Chunking Strategy Benchmark</a></li>
            </ul>
          </div>
        </section>

        <div class="chapter-nav">
          <a href="../index.html" class="nav-link">â† è¿”å› Phase 4</a>
        </div>
      </div>
    </div>
    <script>
      function copyPrompt(btn) {
        const pre = btn.previousElementSibling;
        navigator.clipboard.writeText(pre.innerText);
        const originalText = btn.innerText;
        btn.innerText = "âœ… å·²è¤‡è£½ï¼";
        setTimeout(() => btn.innerText = originalText, 2000);
      }
    </script>
  </body>
</html>