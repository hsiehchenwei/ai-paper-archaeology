<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬å››ç« ï¼šSelf-Attentionï¼ˆä¸‹ï¼‰- Attention è¨ˆç®— | nano-gpt è¦–è¦ºåŒ–æ•™å­¸</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --hero-bg: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1419 100%);
            --gold: #ffd700;
            --silver: #c0c0c0;
            --deep-blue: #0f1419;
            --matrix-green: #00ff41;
            --purple: #9333ea;
            --attention-brown: #daa520;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.8;
            color: #2c3e50;
            background: #ffffff;
        }

        /* èˆ‡ä¸Šä¸€ç« ç›¸åŒçš„æ¨£å¼ */
        .hero-section {
            position: relative;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--hero-bg);
            overflow: hidden;
        }

        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(
                180deg,
                rgba(10, 14, 39, 0.3) 0%,
                rgba(10, 14, 39, 0.85) 60%,
                rgba(10, 14, 39, 0.95) 100%
            );
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            padding: 0 20px;
            max-width: 1000px;
        }

        .nano-gpt-badge {
            display: inline-block;
            background: rgba(218, 165, 32, 0.2);
            border: 2px solid var(--attention-brown);
            padding: 10px 30px;
            border-radius: 50px;
            color: var(--attention-brown);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 30px;
            letter-spacing: 0.1em;
        }

        .hero-title {
            font-family: 'Noto Serif TC', serif;
            font-size: clamp(2.5rem, 6vw, 5rem);
            font-weight: 900;
            color: #FFFFFF;
            margin-bottom: 30px;
            text-shadow: 0 4px 30px rgba(0,0,0,0.8), 0 0 60px rgba(218, 165, 32, 0.3);
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-family: 'Inter', sans-serif;
            font-size: clamp(1.2rem, 2.5vw, 1.8rem);
            color: var(--attention-brown);
            font-weight: 300;
            letter-spacing: 0.05em;
            text-shadow: 0 2px 20px rgba(0,0,0,0.6);
            margin-bottom: 20px;
        }

        .story-container {
            background: #ffffff;
            margin-top: -50px;
            position: relative;
            z-index: 10;
            border-radius: 30px 30px 0 0;
            padding: 80px 40px;
        }

        .content-wrapper {
            max-width: 900px;
            margin: 0 auto;
        }

        .breadcrumb {
            padding: 20px 40px;
            background: rgba(10, 14, 39, 0.05);
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--attention-brown);
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .breadcrumb a:hover {
            opacity: 0.8;
        }

        .story-lead {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.5rem;
            line-height: 2;
            color: #1a1a1a;
            margin: 40px 0;
            padding: 40px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 5px solid var(--attention-brown);
            border-radius: 10px;
        }

        h2 {
            font-family: 'Noto Serif TC', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: #0a0e27;
            margin: 60px 0 30px 0;
            border-bottom: 3px solid var(--attention-brown);
            padding-bottom: 15px;
        }

        h3 {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.8rem;
            color: #1a1f3a;
            margin: 40px 0 20px 0;
        }

        p {
            font-size: 1.1rem;
            line-height: 1.9;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%);
            border: 2px solid var(--purple);
            border-radius: 15px;
            padding: 30px;
            margin: 40px 0;
        }

        .info-box-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.3rem;
            color: var(--purple);
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .matrix-box {
            background: #1a1f3a;
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            border: 2px solid rgba(218, 165, 32, 0.2);
        }

        .matrix-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.3rem;
            color: var(--attention-brown);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .code-visualization {
            background: #1e1e1e;
            border-radius: 15px;
            padding: 30px;
            margin: 40px 0;
            overflow-x: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .code-visualization pre {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.8;
            color: #d4d4d4;
            margin: 0;
        }

        .code-comment { color: #6a9955; }
        .code-keyword { color: #569cd6; }
        .code-string { color: #ce9178; }
        .code-number { color: #b5cea8; }

        .step-box {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-left: 5px solid var(--attention-brown);
        }

        .step-number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: var(--attention-brown);
            color: #0a0e27;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .step-title {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.4rem;
            color: #0a0e27;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .pull-quote {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.8rem;
            font-style: italic;
            color: #0a0e27;
            padding: 40px;
            margin: 60px 0;
            background: linear-gradient(135deg, rgba(218, 165, 32, 0.1) 0%, rgba(218, 165, 32, 0.05) 100%);
            border-left: 5px solid var(--attention-brown);
            border-radius: 10px;
            position: relative;
        }

        .pull-quote::before {
            content: '"';
            position: absolute;
            left: 15px;
            top: 10px;
            font-size: 4rem;
            color: var(--attention-brown);
            opacity: 0.3;
            font-family: Georgia, serif;
        }

        figure {
            margin: 60px 0;
            text-align: center;
        }

        figure img {
            max-width: 100%;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        figcaption {
            margin-top: 20px;
            font-size: 1rem;
            color: #666;
            font-style: italic;
            line-height: 1.6;
        }

        .formula-box {
            background: linear-gradient(135deg, #fff9e6 0%, #fffbf0 100%);
            border: 2px solid var(--attention-brown);
            border-radius: 15px;
            padding: 40px;
            margin: 40px 0;
            text-align: center;
        }

        .formula-title {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.3rem;
            color: #0a0e27;
            margin-bottom: 25px;
            font-weight: 700;
        }

        .formula {
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            color: #0a0e27;
            margin: 20px 0;
            font-weight: 600;
        }

        .formula-desc {
            font-size: 1rem;
            color: #666;
            margin-top: 20px;
            line-height: 1.8;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .comparison-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-top: 4px solid var(--attention-brown);
            transition: transform 0.3s ease;
        }

        .comparison-card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.2rem;
            color: #0a0e27;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .footer-quote {
            background: var(--hero-bg);
            padding: 80px 40px;
            text-align: center;
            margin-top: 100px;
        }

        .footer-quote-text {
            font-family: 'Noto Serif TC', serif;
            font-size: 2rem;
            color: var(--attention-brown);
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.8;
            text-shadow: 0 2px 20px rgba(0,0,0,0.6);
        }

        .footer-quote-author {
            font-family: 'Inter', sans-serif;
            font-size: 1.2rem;
            color: var(--silver);
            font-weight: 300;
        }

        /* Attention Matrix Visual */
        .attention-visual {
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .attention-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin: 20px 0;
            max-width: 400px;
            margin: 20px auto;
        }

        .attention-cell {
            aspect-ratio: 1;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .story-container {
                padding: 40px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="breadcrumb">
        <a href="../../index.html">ğŸ  é¦–é </a>
        <span style="margin: 0 10px; color: #999;">/</span>
        <a href="../index.html">ğŸ“š LLM è¦–è¦ºåŒ–æ•™å­¸</a>
        <span style="margin: 0 10px; color: #999;">/</span>
        <span style="color: #666;">ç¬¬å››ç« ï¼šSelf-Attentionï¼ˆä¸‹ï¼‰</span>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <div class="nano-gpt-badge">nano-gpt Â· Attention è¨ˆç®—æ ¸å¿ƒ</div>
            <h1 class="hero-title">Self-Attention (ä¸‹)</h1>
            <p class="hero-subtitle">å¾ç›¸ä¼¼åº¦åˆ°è¼¸å‡ºï¼šAttention çš„å®Œæ•´è¨ˆç®—</p>
            <p style="font-size: 1rem; color: var(--silver); margin-top: 20px;">
                Dot Product Â· Scaling Â· Softmax Â· Weighted Sum
            </p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="story-container">
        <div class="content-wrapper">
            
            <div class="story-lead">
                æ¥çºŒä¸Šä¸€ç« ï¼Œæˆ‘å€‘å·²ç¶“ç‚ºæ¯å€‹ token ç”Ÿæˆäº† Qã€Kã€V å‘é‡ã€‚<br><br>
                ç¾åœ¨ï¼Œè®“æˆ‘å€‘å­¸ç¿’å¦‚ä½•ä½¿ç”¨é€™äº›å‘é‡ï¼š<br>
                ç”¨ <strong>Query</strong> å°‹æ‰¾ç›¸é—œçš„ <strong>Keys</strong>ï¼Œ<br>
                ç„¶å¾Œæå–å°æ‡‰çš„ <strong>Values</strong>ã€‚
            </div>

            <h2>ğŸ” Self-Attention çš„ã€Œå­—å…¸æŸ¥è©¢ã€</h2>

            <p>å›é¡§è»Ÿé«”ä¸­çš„å­—å…¸æŸ¥è©¢ï¼š</p>

            <div class="matrix-box" style="background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);">
                <div class="matrix-title">è»Ÿé«” vs Self-Attention</div>
                <div class="comparison-grid" style="margin: 0;">
                    <div class="comparison-card" style="background: rgba(255,255,255,0.1); color: white; border-top-color: var(--matrix-green);">
                        <div class="card-title" style="color: var(--matrix-green);">å‚³çµ±å­—å…¸</div>
                        <div class="code-visualization" style="margin: 15px 0 0 0; padding: 20px;">
                            <pre><span class="code-comment"># ç²¾ç¢ºåŒ¹é…</span>
table = {
  <span class="code-string">"key1"</span>: <span class="code-string">"value1"</span>
}
result = table[<span class="code-string">"key1"</span>]
<span class="code-comment"># è¿”å›å–®ä¸€å€¼</span></pre>
                        </div>
                    </div>

                    <div class="comparison-card" style="background: rgba(255,255,255,0.1); color: white; border-top-color: var(--attention-brown);">
                        <div class="card-title" style="color: var(--attention-brown);">Self-Attention</div>
                        <div class="code-visualization" style="margin: 15px 0 0 0; padding: 20px;">
                            <pre><span class="code-comment"># ç›¸ä¼¼åº¦åŒ¹é…</span>
scores = Q @ K.T
weights = softmax(scores)
result = weights @ V
<span class="code-comment"># è¿”å›åŠ æ¬Šçµ„åˆ</span></pre>
                        </div>
                    </div>
                </div>
            </div>

            <h2>ğŸ“ å®Œæ•´çš„ Attention è¨ˆç®—æµç¨‹</h2>

            <figure>
                <img src="../../images/attention_calculation_20260105212752.png" alt="Attention è¨ˆç®—å®Œæ•´æµç¨‹">
                <figcaption>
                    è¦–è¦ºåŒ–ï¼šå¾ Q/K/V å‘é‡åˆ°æœ€çµ‚è¼¸å‡ºçš„å®Œæ•´è¨ˆç®—éç¨‹
                </figcaption>
            </figure>

            <h3>æ­¥é©Ÿ 1ï¼šè¨ˆç®—ç›¸ä¼¼åº¦ï¼ˆDot Productï¼‰</h3>

            <div class="step-box">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <span class="step-number">1</span>
                    <span class="step-title">Query èˆ‡æ‰€æœ‰ Keys çš„é»ç©</span>
                </div>
                <p>æˆ‘å€‘ç”¨ç•¶å‰ä½ç½®çš„ <strong>Q å‘é‡</strong>èˆ‡éå»æ‰€æœ‰ä½ç½®çš„ <strong>K å‘é‡</strong>åšé»ç©ã€‚</p>
                
                <p style="margin-top: 20px;"><strong>ç‚ºä»€éº¼ç”¨é»ç©ï¼Ÿ</strong></p>
                <p>é»ç©èƒ½å¤ æ¸¬é‡å…©å€‹å‘é‡çš„ç›¸ä¼¼åº¦ï¼š</p>
                <ul style="margin-left: 20px; line-height: 2; margin-top: 10px;">
                    <li>å¦‚æœæ–¹å‘ç›¸ä¼¼ â†’ é»ç©<strong>è¼ƒå¤§</strong></li>
                    <li>å¦‚æœæ–¹å‘ç›¸å â†’ é»ç©<strong>è¼ƒå°æˆ–è² å€¼</strong></li>
                </ul>
            </div>

            <div class="matrix-box">
                <div class="matrix-title">å…·é«”ç¯„ä¾‹ï¼št = 5 çš„ä½ç½®</div>
                <div class="code-visualization">
                    <pre><span class="code-comment"># å‡è¨­æˆ‘å€‘åœ¨ç¬¬ 6 å€‹ token (t = 5)</span>

Q[5] = [<span class="code-number">16</span> å€‹æµ®é»æ•¸]  <span class="code-comment"># ç•¶å‰ä½ç½®çš„ Query</span>

<span class="code-comment"># åªèƒ½çœ‹åˆ°éå»ï¼ˆå› æœ self-attentionï¼‰</span>
K[0] = [<span class="code-number">16</span> å€‹æµ®é»æ•¸]  <span class="code-comment"># ç¬¬ 1 å€‹ä½ç½®çš„ Key</span>
K[1] = [<span class="code-number">16</span> å€‹æµ®é»æ•¸]  <span class="code-comment"># ç¬¬ 2 å€‹ä½ç½®çš„ Key</span>
K[2] = [<span class="code-number">16</span> å€‹æµ®é»æ•¸]
K[3] = [<span class="code-number">16</span> å€‹æµ®é»æ•¸]
K[4] = [<span class="code-number">16</span> å€‹æµ®é»æ•¸]
K[5] = [<span class="code-number">16</span> å€‹æµ®é»æ•¸]  <span class="code-comment"># è‡ªå·±çš„ Key</span>

<span class="code-comment"># è¨ˆç®—èˆ‡æ¯å€‹ Key çš„ç›¸ä¼¼åº¦</span>
score[5][0] = Q[5] Â· K[0]  <span class="code-comment"># = 0.32</span>
score[5][1] = Q[5] Â· K[1]  <span class="code-comment"># = -0.15</span>
score[5][2] = Q[5] Â· K[2]  <span class="code-comment"># = 0.89</span>
score[5][3] = Q[5] Â· K[3]  <span class="code-comment"># = 0.56</span>
score[5][4] = Q[5] Â· K[4]  <span class="code-comment"># = 1.24</span>
score[5][5] = Q[5] Â· K[5]  <span class="code-comment"># = 0.78 (èˆ‡è‡ªå·±)</span>

<span class="code-comment"># é€™äº›åˆ†æ•¸å­˜å„²åœ¨ Attention Matrix çš„ç¬¬ 5 åˆ—</span></pre>
                </div>
            </div>

            <div class="info-box">
                <div class="info-box-title">
                    <span>ğŸ”’</span>
                    <span>å› æœ Self-Attention (Causal Self-Attention)</span>
                </div>
                <p>æ³¨æ„æˆ‘å€‘åªä½¿ç”¨<strong>éå»å’Œç•¶å‰</strong>çš„ Keysï¼Œä¸ä½¿ç”¨æœªä¾†çš„ Keysã€‚</p>
                <p style="margin-top: 15px;">é€™è¢«ç¨±ç‚º<strong>å› æœ</strong>æˆ–<strong>é®ç½©</strong> Self-Attentionï¼Œç¢ºä¿æ¨¡å‹ä¸èƒ½ã€Œçœ‹åˆ°æœªä¾†ã€ã€‚</p>
                <p style="margin-top: 15px; font-style: italic; color: #666;">é€™å°æ–¼ç”Ÿæˆä»»å‹™ï¼ˆå¦‚æ–‡å­—ç”Ÿæˆï¼‰éå¸¸é‡è¦ï¼šæ¨¡å‹åªèƒ½æ ¹æ“šå·²ç”Ÿæˆçš„å…§å®¹é æ¸¬ä¸‹ä¸€å€‹å­—ã€‚</p>
            </div>

            <h3>æ­¥é©Ÿ 2ï¼šScalingï¼ˆç¸®æ”¾ï¼‰</h3>

            <div class="step-box">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <span class="step-number">2</span>
                    <span class="step-title">é™¤ä»¥ âˆšA</span>
                </div>
                <p>åœ¨é»ç©å¾Œï¼Œæˆ‘å€‘å°‡çµæœé™¤ä»¥ <code>âˆšA</code>ï¼Œå…¶ä¸­ <code>A</code> æ˜¯ Q/K/V å‘é‡çš„é•·åº¦ã€‚</p>
            </div>

            <div class="formula-box">
                <div class="formula-title">Scaled Dot Product</div>
                <div class="formula">
                    scaled_score = score / âˆšA
                </div>
                <div class="formula-desc">
                    åœ¨ nano-gpt ä¸­ï¼šA = 16ï¼ˆhead ç¶­åº¦ï¼‰<br>
                    æ‰€ä»¥æˆ‘å€‘é™¤ä»¥ âˆš16 = 4
                </div>
            </div>

            <div class="info-box" style="background: linear-gradient(135deg, rgba(218, 165, 32, 0.1) 0%, rgba(218, 165, 32, 0.05) 100%); border-color: var(--attention-brown);">
                <div class="info-box-title" style="color: var(--attention-brown);">
                    <span>ğŸ¯</span>
                    <span>ç‚ºä»€éº¼è¦ Scalingï¼Ÿ</span>
                </div>
                <p>é˜²æ­¢é»ç©çµæœå¤ªå¤§ï¼Œå°è‡´ Softmax æ¢¯åº¦æ¶ˆå¤±ã€‚</p>
                <p style="margin-top: 15px;"><strong>æ•¸å­¸ç›´è¦ºï¼š</strong></p>
                <ul style="margin-left: 20px; line-height: 2; margin-top: 10px;">
                    <li>å‘é‡è¶Šé•·ï¼Œé»ç©çµæœè¶Šå¤§</li>
                    <li>å¤§çš„æ•¸å€¼é€²å…¥ Softmax æœƒå°è‡´æ¥µç«¯çš„æ©Ÿç‡ï¼ˆæ¥è¿‘ 0 æˆ– 1ï¼‰</li>
                    <li>Scaling è®“æ•¸å€¼ä¿æŒåœ¨åˆç†ç¯„åœï¼ŒSoftmax æ›´ç©©å®š</li>
                </ul>
            </div>

            <div class="matrix-box">
                <div class="matrix-title">Scaling ç¯„ä¾‹</div>
                <div class="code-visualization">
                    <pre><span class="code-comment"># åŸå§‹åˆ†æ•¸</span>
scores = [<span class="code-number">0.32</span>, <span class="code-number">-0.15</span>, <span class="code-number">0.89</span>, <span class="code-number">0.56</span>, <span class="code-number">1.24</span>, <span class="code-number">0.78</span>]

<span class="code-comment"># Scaling</span>
A = <span class="code-number">16</span>  <span class="code-comment"># Q/K/V å‘é‡é•·åº¦</span>
scale_factor = sqrt(A) = <span class="code-number">4.0</span>

scaled_scores = [
    <span class="code-number">0.32</span>/<span class="code-number">4</span>, <span class="code-number">-0.15</span>/<span class="code-number">4</span>, <span class="code-number">0.89</span>/<span class="code-number">4</span>, 
    <span class="code-number">0.56</span>/<span class="code-number">4</span>, <span class="code-number">1.24</span>/<span class="code-number">4</span>, <span class="code-number">0.78</span>/<span class="code-number">4</span>
]
= [<span class="code-number">0.08</span>, <span class="code-number">-0.04</span>, <span class="code-number">0.22</span>, <span class="code-number">0.14</span>, <span class="code-number">0.31</span>, <span class="code-number">0.20</span>]</pre>
                </div>
            </div>

            <h3>æ­¥é©Ÿ 3ï¼šSoftmaxï¼ˆæ­£è¦åŒ–ç‚ºæ©Ÿç‡ï¼‰</h3>

            <div class="step-box">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <span class="step-number">3</span>
                    <span class="step-title">å°‡åˆ†æ•¸è½‰æ›ç‚ºæ©Ÿç‡åˆ†ä½ˆ</span>
                </div>
                <p>Softmax å°‡ä»»æ„æ•¸å€¼è½‰æ›ç‚ºç¸½å’Œç‚º 1 çš„æ©Ÿç‡åˆ†ä½ˆã€‚</p>
            </div>

            <div class="formula-box">
                <div class="formula-title">Softmax å…¬å¼</div>
                <div class="formula" style="font-size: 1.5rem;">
                    softmax(xáµ¢) = exp(xáµ¢) / Î£ exp(xâ±¼)
                </div>
                <div class="formula-desc">
                    å°æ¯å€‹å…ƒç´ å–æŒ‡æ•¸ï¼Œç„¶å¾Œé™¤ä»¥æ‰€æœ‰å…ƒç´ æŒ‡æ•¸çš„ç¸½å’Œ
                </div>
            </div>

            <div class="matrix-box">
                <div class="matrix-title">Softmax ç¯„ä¾‹</div>
                <div class="code-visualization">
                    <pre><span class="code-comment"># ç¸®æ”¾å¾Œçš„åˆ†æ•¸</span>
scaled = [<span class="code-number">0.08</span>, <span class="code-number">-0.04</span>, <span class="code-number">0.22</span>, <span class="code-number">0.14</span>, <span class="code-number">0.31</span>, <span class="code-number">0.20</span>]

<span class="code-comment"># æ­¥é©Ÿ 1: å°æ¯å€‹å…ƒç´ å–æŒ‡æ•¸</span>
exp_values = [
    exp(<span class="code-number">0.08</span>)=<span class="code-number">1.08</span>, exp(<span class="code-number">-0.04</span>)=<span class="code-number">0.96</span>, exp(<span class="code-number">0.22</span>)=<span class="code-number">1.25</span>,
    exp(<span class="code-number">0.14</span>)=<span class="code-number">1.15</span>, exp(<span class="code-number">0.31</span>)=<span class="code-number">1.36</span>, exp(<span class="code-number">0.20</span>)=<span class="code-number">1.22</span>
]

<span class="code-comment"># æ­¥é©Ÿ 2: è¨ˆç®—ç¸½å’Œ</span>
sum_exp = <span class="code-number">1.08</span> + <span class="code-number">0.96</span> + <span class="code-number">1.25</span> + <span class="code-number">1.15</span> + <span class="code-number">1.36</span> + <span class="code-number">1.22</span> = <span class="code-number">7.02</span>

<span class="code-comment"># æ­¥é©Ÿ 3: æ­£è¦åŒ–</span>
attention_weights = [
    <span class="code-number">1.08</span>/<span class="code-number">7.02</span>=<span class="code-number">0.15</span>, <span class="code-number">0.96</span>/<span class="code-number">7.02</span>=<span class="code-number">0.14</span>, <span class="code-number">1.25</span>/<span class="code-number">7.02</span>=<span class="code-number">0.18</span>,
    <span class="code-number">1.15</span>/<span class="code-number">7.02</span>=<span class="code-number">0.16</span>, <span class="code-number">1.36</span>/<span class="code-number">7.02</span>=<span class="code-number">0.19</span>, <span class="code-number">1.22</span>/<span class="code-number">7.02</span>=<span class="code-number">0.17</span>
]

<span class="code-comment"># ç¸½å’Œ = 1.0 âœ…</span>
<span class="code-comment"># é€™äº›å°±æ˜¯ Attention Matrix ä¸­çš„æ¬Šé‡ï¼</span></pre>
                </div>
            </div>

            <div class="attention-visual">
                <h3 style="text-align: center; color: #0a0e27; margin-bottom: 30px;">ğŸ“Š Attention Matrix è¦–è¦ºåŒ–</h3>
                <p style="text-align: center; color: #666; margin-bottom: 20px;">é¡è‰²æ·±æ·ºä»£è¡¨æ³¨æ„åŠ›æ¬Šé‡ï¼ˆè¶Šæ·± = è¶Šé‡è¦ï¼‰</p>
                <div class="attention-grid">
                    <div class="attention-cell" style="background: rgba(218, 165, 32, 0.3);">0.15</div>
                    <div class="attention-cell" style="background: rgba(218, 165, 32, 0.3);">0.14</div>
                    <div class="attention-cell" style="background: rgba(218, 165, 32, 0.5);">0.18</div>
                    <div class="attention-cell" style="background: rgba(218, 165, 32, 0.4);">0.16</div>
                    <div class="attention-cell" style="background: rgba(218, 165, 32, 0.6);">0.19</div>
                    <div class="attention-cell" style="background: rgba(218, 165, 32, 0.4);">0.17</div>
                </div>
                <p style="text-align: center; color: #666; margin-top: 20px; font-size: 0.95rem;">
                    é€™åˆ—ä»£è¡¨ä½ç½® 5 å°éå»æ‰€æœ‰ä½ç½®ï¼ˆ0-5ï¼‰çš„æ³¨æ„åŠ›åˆ†é…<br>
                    ä½ç½® 4 ç²å¾—æœ€é«˜æ³¨æ„åŠ› (0.19)
                </p>
            </div>

            <h3>æ­¥é©Ÿ 4ï¼šåŠ æ¬Šæ±‚å’Œï¼ˆWeighted Sumï¼‰</h3>

            <div class="step-box">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <span class="step-number">4</span>
                    <span class="step-title">ä½¿ç”¨æ¬Šé‡æå– Values</span>
                </div>
                <p>ç¾åœ¨æˆ‘å€‘æœ‰äº†æ³¨æ„åŠ›æ¬Šé‡ï¼Œæœ€å¾Œä¸€æ­¥æ˜¯ç”¨é€™äº›æ¬Šé‡å° <strong>V å‘é‡</strong>é€²è¡ŒåŠ æ¬Šå¹³å‡ã€‚</p>
            </div>

            <div class="matrix-box">
                <div class="matrix-title">åŠ æ¬Šæ±‚å’Œéç¨‹</div>
                <div class="code-visualization">
                    <pre><span class="code-comment"># æ³¨æ„åŠ›æ¬Šé‡ï¼ˆä¾†è‡ª Softmaxï¼‰</span>
weights = [<span class="code-number">0.15</span>, <span class="code-number">0.14</span>, <span class="code-number">0.18</span>, <span class="code-number">0.16</span>, <span class="code-number">0.19</span>, <span class="code-number">0.17</span>]

<span class="code-comment"># æ‰€æœ‰ä½ç½®çš„ V å‘é‡ï¼ˆæ¯å€‹éƒ½æ˜¯ [16]ï¼‰</span>
V[0] = [vâ‚€â‚€, vâ‚€â‚, ..., vâ‚€â‚â‚…]
V[1] = [vâ‚â‚€, vâ‚â‚, ..., vâ‚â‚â‚…]
...
V[5] = [vâ‚…â‚€, vâ‚…â‚, ..., vâ‚…â‚â‚…]

<span class="code-comment"># è¼¸å‡º = åŠ æ¬Šçµ„åˆ</span>
output = <span class="code-number">0.15</span>*V[0] + <span class="code-number">0.14</span>*V[1] + <span class="code-number">0.18</span>*V[2] 
       + <span class="code-number">0.16</span>*V[3] + <span class="code-number">0.19</span>*V[4] + <span class="code-number">0.17</span>*V[5]

<span class="code-comment"># çµæœï¼šä¸€å€‹æ–°çš„å‘é‡ [16]</span>
<span class="code-comment"># é€™å€‹å‘é‡èåˆäº†æ‰€æœ‰ç›¸é—œä½ç½®çš„è³‡è¨Šï¼</span></pre>
                </div>
            </div>

            <div class="pull-quote">
                è¼¸å‡ºå‘é‡æœƒè¢«æ¬Šé‡<strong>æœ€é«˜</strong>çš„ V å‘é‡ä¸»å°ã€‚<br><br>
                é€™å°±æ˜¯ Self-Attention çš„æ ¸å¿ƒï¼š<br>
                æ¯å€‹ä½ç½®èƒ½å¾å…¶ä»–ç›¸é—œä½ç½®ã€Œæå–ã€è³‡è¨Šã€‚
            </div>

            <h2>ğŸ”„ å°æ‰€æœ‰åˆ—é‡è¤‡æ­¤éç¨‹</h2>

            <p>æˆ‘å€‘å‰›å‰›è©³ç´°èªªæ˜äº†<strong>ä¸€å€‹ä½ç½®</strong>ï¼ˆt = 5ï¼‰çš„è¨ˆç®—éç¨‹ã€‚å¯¦éš›ä¸Šï¼Œæˆ‘å€‘éœ€è¦å°<strong>æ‰€æœ‰ 6 å€‹ä½ç½®</strong>é‡è¤‡é€™å€‹éç¨‹ã€‚</p>

            <div class="matrix-box">
                <div class="matrix-title">å®Œæ•´çš„ Self-Attention è¼¸å‡º</div>
                <div class="code-visualization">
                    <pre><span class="code-comment"># è¼¸å…¥ï¼š[6 Ã— 48] æ­£è¦åŒ–çŸ©é™£</span>
<span class="code-comment"># Q/K/V çŸ©é™£ï¼š[6 Ã— 16] (æ¯å€‹)</span>

<span class="code-comment"># å°æ¯å€‹ä½ç½®è¨ˆç®—è¼¸å‡º</span>
<span class="code-keyword">for</span> t <span class="code-keyword">in</span> <span class="code-keyword">range</span>(<span class="code-number">6</span>):
    <span class="code-comment"># 1. è¨ˆç®—èˆ‡æ‰€æœ‰éå» Keys çš„ç›¸ä¼¼åº¦</span>
    scores = [Q[t] Â· K[i] <span class="code-keyword">for</span> i <span class="code-keyword">in</span> <span class="code-keyword">range</span>(t+<span class="code-number">1</span>)]
    
    <span class="code-comment"># 2. Scaling</span>
    scaled = scores / sqrt(<span class="code-number">16</span>)
    
    <span class="code-comment"># 3. Softmax</span>
    attention_weights[t] = softmax(scaled)
    
    <span class="code-comment"># 4. åŠ æ¬Šæ±‚å’Œ</span>
    output[t] = <span class="code-keyword">sum</span>(attention_weights[t][i] * V[i] 
                    <span class="code-keyword">for</span> i <span class="code-keyword">in</span> <span class="code-keyword">range</span>(t+<span class="code-number">1</span>))

<span class="code-comment"># æœ€çµ‚è¼¸å‡ºï¼š[6 Ã— 16] çŸ©é™£</span>
<span class="code-comment"># æ¯åˆ—éƒ½èåˆäº†éå»ç›¸é—œä½ç½®çš„è³‡è¨Š</span></pre>
                </div>
            </div>

            <h2>ğŸ’¡ Self-Attention çš„ç›®æ¨™</h2>

            <div class="info-box" style="background: linear-gradient(135deg, rgba(218, 165, 32, 0.15) 0%, rgba(218, 165, 32, 0.08) 100%); border-color: var(--attention-brown);">
                <div class="info-box-title" style="color: var(--attention-brown);">
                    <span>ğŸ¯</span>
                    <span>Self-Attention çš„æ ¸å¿ƒç›®æ¨™</span>
                </div>
                <p style="font-size: 1.2rem; line-height: 2;">
                    <strong>æ¯ä¸€åˆ—ï¼ˆtokenï¼‰æƒ³è¦å¾å…¶ä»–åˆ—æ‰¾åˆ°ç›¸é—œè³‡è¨Šä¸¦æå–å…¶å€¼ã€‚</strong>
                </p>
                <p style="margin-top: 20px;">å®ƒé€šéä»¥ä¸‹æ–¹å¼å¯¦ç¾ï¼š</p>
                <ul style="margin-left: 20px; line-height: 2; margin-top: 15px;">
                    <li>ç”¨è‡ªå·±çš„ <strong>Query</strong> èˆ‡å…¶ä»–çš„ <strong>Keys</strong> æ¯”è¼ƒï¼ˆç›¸ä¼¼åº¦ï¼‰</li>
                    <li>æ ¹æ“šç›¸ä¼¼åº¦åˆ†é…æ³¨æ„åŠ›æ¬Šé‡ï¼ˆSoftmaxï¼‰</li>
                    <li>ç”¨æ¬Šé‡æå–å°æ‡‰çš„ <strong>Values</strong>ï¼ˆåŠ æ¬Šæ±‚å’Œï¼‰</li>
                    <li><strong>é™åˆ¶</strong>ï¼šåªèƒ½çœ‹åˆ°éå»ï¼ˆå› æœé®ç½©ï¼‰</li>
                </ul>
            </div>

            <h2>ğŸ“ nano-gpt çš„åƒæ•¸çµ±è¨ˆ</h2>

            <div class="matrix-box">
                <div class="code-visualization">
                    <pre><span class="code-comment"># Single Head Self-Attention ç¸½çµ</span>

<span class="code-comment">## è¼¸å…¥/è¼¸å‡ºå½¢ç‹€</span>
è¼¸å…¥ï¼š[<span class="code-number">6</span> Ã— <span class="code-number">48</span>] æ­£è¦åŒ–çŸ©é™£
Q/K/Vï¼šæ¯å€‹éƒ½æ˜¯ [<span class="code-number">6</span> Ã— <span class="code-number">16</span>]
Attention Matrixï¼š[<span class="code-number">6</span> Ã— <span class="code-number">6</span>] (å¯¦éš›æ˜¯ä¸‹ä¸‰è§’)
è¼¸å‡ºï¼š[<span class="code-number">6</span> Ã— <span class="code-number">16</span>]

<span class="code-comment">## åƒæ•¸æ•¸é‡ï¼ˆå–®å€‹ headï¼‰</span>
Q_weights: [<span class="code-number">16</span> Ã— <span class="code-number">48</span>] + [<span class="code-number">16</span>] = <span class="code-number">784</span>
K_weights: [<span class="code-number">16</span> Ã— <span class="code-number">48</span>] + [<span class="code-number">16</span>] = <span class="code-number">784</span>
V_weights: [<span class="code-number">16</span> Ã— <span class="code-number">48</span>] + [<span class="code-number">16</span>] = <span class="code-number">784</span>
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¸½è¨ˆï¼š<span class="code-number">2,352</span> å€‹åƒæ•¸ï¼ˆå–®å€‹ headï¼‰

<span class="code-comment">## é—œéµè¶…åƒæ•¸</span>
C (æ¨¡å‹ç¶­åº¦)ï¼š<span class="code-number">48</span>
d_k (head ç¶­åº¦)ï¼š<span class="code-number">16</span>
T (åºåˆ—é•·åº¦)ï¼š<span class="code-number">6</span>
ç¸®æ”¾å› å­ï¼šâˆš<span class="code-number">16</span> = <span class="code-number">4</span></pre>
                </div>
            </div>

            <h2>ğŸš€ ä¸‹ä¸€æ­¥ï¼šMulti-Head Attention</h2>

            <p>æˆ‘å€‘å‰›å‰›æ¢ç´¢äº†<strong>å–®å€‹ head</strong> çš„ Self-Attentionã€‚</p>

            <p>å¯¦éš›ä¸Šï¼ŒTransformer æœƒå¹³è¡Œé‹è¡Œ<strong>å¤šå€‹ heads</strong>ï¼Œæ¯å€‹ head å­¸ç¿’ä¸åŒçš„é—œæ³¨æ¨¡å¼ã€‚</p>

            <div class="comparison-grid">
                <div class="comparison-card" style="border-top-color: var(--attention-brown);">
                    <div class="card-title">â†’ ç¬¬äº”ç« </div>
                    <p><strong>Multi-Head Attention</strong></p>
                    <p>å¤šå€‹æ³¨æ„åŠ›è¦–è§’çš„å¹³è¡Œè™•ç†</p>
                </div>

                <div class="comparison-card" style="border-top-color: #87ceeb;">
                    <div class="card-title">â†’ ç¬¬å…­ç« </div>
                    <p><strong>Feed Forward Network</strong></p>
                    <p>Transformer Block çš„ç¬¬äºŒçµ„ä»¶</p>
                </div>

                <div class="comparison-card" style="border-top-color: var(--purple);">
                    <div class="card-title">â†’ ç¬¬ä¸ƒç« </div>
                    <p><strong>Residual Connection</strong></p>
                    <p>ç©©å®šæ·±å±¤ç¶²çµ¡è¨“ç·´çš„æŠ€å·§</p>
                </div>
            </div>

            <h2 style="margin-top: 80px;">ğŸ—ºï¸ å›é¡§æ¶æ§‹å…¨è²Œ</h2>

            <div class="info-box" style="background: linear-gradient(135deg, rgba(218, 165, 32, 0.1) 0%, rgba(218, 165, 32, 0.05) 100%); border-color: var(--attention-brown);">
                <div class="info-box-title" style="color: var(--attention-brown);">
                    <span>ğŸ“</span>
                    <span>Self-Attention å®Œæ•´è¨ˆç®—åœ¨æ¶æ§‹ä¸­çš„ä½ç½®</span>
                </div>
                <figure style="margin: 20px 0 0 0;">
                    <img src="../../images/llm_architecture_full_20260105210724.png" alt="LLM å®Œæ•´æ¶æ§‹" style="max-width: 100%; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                    <figcaption style="margin-top: 20px; font-size: 1rem; color: #666; line-height: 1.8;">
                        å®Œæ•´æ¶æ§‹åœ–ï¼šæˆ‘å€‘å‰›å‰›å®Œæˆäº† <span style="color: #daa520; font-weight: 700;">Self-Attention çš„å®Œæ•´è¨ˆç®—éç¨‹</span><br>
                        ï¼ˆå¾ Q/K/V ç”Ÿæˆåˆ°æœ€çµ‚è¼¸å‡ºï¼‰
                    </figcaption>
                </figure>
                <div style="text-align: center; margin-top: 30px;">
                    <a href="../index.html" style="display: inline-block; padding: 15px 40px; background: var(--attention-brown); color: #0a0e27; text-decoration: none; border-radius: 50px; font-weight: 700; transition: transform 0.3s ease;">
                        â† è¿”å›æ•™å­¸é¦–é æŸ¥çœ‹æ‰€æœ‰ç« ç¯€
                    </a>
                </div>
            </div>

        </div>
    </div>

    <!-- Chapter Navigation -->
    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 60px 40px; margin-top: 80px;">
        <div style="max-width: 900px; margin: 0 auto;">
            
            <h2 style="font-family: 'Noto Serif TC', serif; font-size: 2rem; color: #0a0e27; text-align: center; margin-bottom: 40px; border: none; padding: 0;">
                ğŸ¯ æœ¬ç« é‡é»å›é¡§
            </h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 20px; margin-bottom: 50px;">
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 2rem; margin-bottom: 10px;">âš¡</div>
                    <div style="font-weight: 700; color: #0a0e27; margin-bottom: 8px;">Dot Product ç›¸ä¼¼åº¦</div>
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.6;">QÂ·K è¨ˆç®— tokens ä¹‹é–“çš„ç›¸é—œæ€§</div>
                </div>

                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ“</div>
                    <div style="font-weight: 700; color: #0a0e27; margin-bottom: 8px;">Scaling ç¸®æ”¾</div>
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.6;">é™¤ä»¥ âˆšhead_dim ç©©å®šæ•¸å€¼</div>
                </div>

                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ¯</div>
                    <div style="font-weight: 700; color: #0a0e27; margin-bottom: 8px;">Softmax æ­£è¦åŒ–</div>
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.6;">è½‰æ›ç‚ºæ©Ÿç‡åˆ†ä½ˆï¼ˆç¸½å’Œç‚º 1ï¼‰</div>
                </div>

                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 2rem; margin-bottom: 10px;">â•</div>
                    <div style="font-weight: 700; color: #0a0e27; margin-bottom: 8px;">åŠ æ¬Šå’Œè¼¸å‡º</div>
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.6;">ç”¨æ³¨æ„åŠ›æ¬Šé‡åŠ æ¬Š V å‘é‡</div>
                </div>
            </div>

            <div style="border-top: 2px solid #dee2e6; padding-top: 40px; margin-top: 40px;">
                <h3 style="font-family: 'Noto Serif TC', serif; font-size: 1.5rem; color: #0a0e27; text-align: center; margin-bottom: 30px;">
                    ğŸ“š ç« ç¯€å°èˆª
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <a href="03a-self-attention-qkv.html" style="display: flex; align-items: center; gap: 15px; padding: 25px; background: white; border-radius: 15px; text-decoration: none; color: #0a0e27; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <div style="font-size: 2rem;">â¬…ï¸</div>
                        <div>
                            <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">ä¸Šä¸€ç« </div>
                            <div style="font-weight: 700; font-size: 1.1rem;">Self-Attention: Q/K/V</div>
                            <div style="font-size: 0.9rem; color: #999; margin-top: 3px;">Q/K/V å‘é‡ç”Ÿæˆ</div>
                        </div>
                    </a>

                    <a href="04-multihead-projection-residual.html" style="display: flex; align-items: center; justify-content: flex-end; gap: 15px; padding: 25px; background: linear-gradient(135deg, #ffd700 0%, #f0c000 100%); border-radius: 15px; text-decoration: none; color: #0a0e27; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                        <div style="text-align: right;">
                            <div style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 5px;">ä¸‹ä¸€ç« </div>
                            <div style="font-weight: 700; font-size: 1.1rem;">Multi-Head & Projection</div>
                            <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 5px;">åˆä½µå¤šå€‹ heads</div>
                        </div>
                        <div style="font-size: 2rem;">â¡ï¸</div>
                    </a>
                </div>

                <div style="text-align: center; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 12px; border: 2px dashed var(--gold);">
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.8;">
                        <strong style="color: #0a0e27;">ğŸ’¡ ä¸‹ä¸€æ­¥å­¸ä»€éº¼ï¼Ÿ</strong><br>
                        å–®å€‹ head çš„è¨ˆç®—å®Œæˆï¼ä½† Multi-Head Attention æœ‰<strong style="color: var(--gold);">å¤šå€‹å¹³è¡Œçš„ heads</strong>ï¼Œ<br>
                        éœ€è¦åˆä½µå®ƒå€‘çš„è¼¸å‡ºä¸¦é€²è¡Œ Projectionï¼Œå½¢æˆæœ€çµ‚çš„ Self-Attention è¼¸å‡ºã€‚
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer Quote -->
    <div class="footer-quote">
        <p class="footer-quote-text">
            ã€ŒSelf-Attentionï¼šè®“æ¯å€‹ token<br>
            éƒ½èƒ½è½åˆ°å…¶ä»– tokens çš„è²éŸ³ã€‚ã€
        </p>
        <p class="footer-quote-author">â€” LLM è¦–è¦ºåŒ–æ•™å­¸ Â· 2026</p>
    </div>

</body>
</html>

