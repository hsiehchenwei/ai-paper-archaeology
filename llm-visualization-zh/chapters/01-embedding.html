<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第一章：Embedding - 從整數到向量 | nano-gpt 視覺化教學</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../styles/llm-viz.css">
</head>
<body>
    <div class="breadcrumb">
        <a href="../../index.html">🏠 首頁</a>
        <span style="margin: 0 10px; color: #999;">/</span>
        <a href="../index.html">📚 LLM 視覺化教學</a>
        <span style="margin: 0 10px; color: #999;">/</span>
        <span style="color: #666;">第一章：Embedding</span>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <div class="nano-gpt-badge">nano-gpt · n_params = 85,584</div>
            <h1 class="hero-title">Embedding：從整數到向量</h1>
            <p class="hero-subtitle">第一次也是唯一一次，我們看到整數</p>
            <p class="hero-meta">之後的世界，全是浮點數</p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="story-container">
        <div class="content-wrapper">
            
            <h2 style="border: none; margin-top: 0; text-align: center; color: var(--gold);">🗺️ 本章在架構中的位置</h2>

            <div class="info-box" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.08) 100%); border-color: var(--gold); margin: 40px 0 60px 0;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="display: inline-block; padding: 15px 40px; background: rgba(255, 215, 0, 0.2); border: 2px solid var(--gold); border-radius: 50px; font-size: 1.2rem; font-weight: 700; color: var(--gold);">
                        📍 第一章：Embedding
                    </div>
                </div>
                
                <figure style="margin: 30px 0;">
                    <img src="../../images/embedding_chapter_focus_20260105210902.png" alt="Embedding 章節架構特寫" style="max-width: 100%; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                    <figcaption style="margin-top: 20px; font-size: 1rem; color: #666; line-height: 1.8;">
                        <strong style="color: #0a0e27;">Embedding 層架構特寫</strong><br>
                        本章聚焦於<span style="color: #c71585; font-weight: 700;"> 粉紅色區域</span>：<br>
                        Token Embedding + Position Embedding → Input Embedding
                    </figcaption>
                </figure>

                <div style="background: rgba(255, 255, 255, 0.6); padding: 25px; border-radius: 12px; margin-top: 30px;">
                    <p style="margin: 0; text-align: center; color: #2c3e50; line-height: 1.9;">
                        <strong style="color: #c71585;">🟣 Embedding 是整個 LLM 的起點</strong><br>
                        在這裡，我們將離散的 token 索引（整數）轉換成連續的向量（浮點數），<br>
                        為後續的 Transformer 層處理做準備。
                    </p>
                </div>
            </div>
            
            <div class="story-lead">
                「我們之前看到 tokens 如何通過簡單的查找表映射成一串整數。<br>
                這些整數，也就是 token 索引，是模型中<strong>第一次也是唯一一次出現整數</strong>的地方。<br>
                從這裡開始，我們使用的全部都是浮點數（小數）。」
            </div>

            <div class="info-box">
                <div class="info-box-title">
                    <span>💡</span>
                    <span>核心概念</span>
                </div>
                <p><strong>整數 → 浮點數的轉換</strong></p>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li><strong>Token 索引（整數）</strong>：["C", "B", "A", "B", "B", "C"] → [2, 1, 0, 1, 1, 2]</li>
                    <li><strong>Embedding（浮點數）</strong>：每個索引對應一個 48 維的浮點數向量</li>
                    <li><strong>為什麼？</strong>：神經網絡需要連續的數值空間來進行梯度計算</li>
                </ul>
            </div>

            <h2>🎯 完整流程：從 Token 到 Input Embedding</h2>

            <p>讓我們以第 4 個 token（索引 3，位置從 0 開始計數）為例，看看它如何生成 input embedding 的第 4 列向量。</p>

            <div class="dimension-card">
                <p style="margin: 0; font-size: 1.2rem;">nano-gpt 的維度設定</p>
                <div class="dimension-value">C = 48</div>
                <p style="margin: 0;">每個向量的長度（channel/feature/dimension/embedding size）</p>
            </div>

            <h2>📍 步驟 1：Token Embedding 查找</h2>

            <div class="step-box">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <span class="step-number">1</span>
                    <span class="step-title">使用 Token 索引查找向量</span>
                </div>
                <p>我們使用 token 索引（在這個例子中，B = 1）來選擇左邊 <strong>token embedding 矩陣</strong>的第 2 列。</p>
                <p style="color: #666; font-size: 0.95rem;">⚠️ 注意：我們使用 0-based 索引，所以第一列是索引 0</p>
            </div>

            <div class="matrix-box">
                <div class="matrix-title">Token Embedding 查找過程</div>
                <div class="code-visualization">
                    <pre><span class="code-comment"># Token Embedding Matrix: [Vocab_Size × C] = [3 × 48]</span>

Token    Index    選擇哪一列
───────────────────────────────
  A        0      第 1 列（索引 0）
  <span class="code-keyword">B</span>        <span class="code-number">1</span>      <span class="code-keyword">第 2 列（索引 1）</span> ← 我們要的！
  C        2      第 3 列（索引 2）

<span class="code-comment"># 結果：得到一個長度為 C = 48 的列向量</span>
Token Embedding = <span class="code-keyword">[第 2 列的 48 個浮點數]</span></pre>
                </div>
            </div>

            <figure>
                <img src="../../images/nanogpt_token_lookup_20260105204504.png" alt="Token Index 查找過程">
                <figcaption>
                    視覺化：使用 Token B (索引=1) 從 Token Embedding 矩陣中選擇第 2 列
                </figcaption>
            </figure>

            <div class="pull-quote">
                這個過程產生一個大小為 C = 48 的列向量，<br>
                我們稱之為 <strong>token embedding</strong>。
            </div>

            <h2>📍 步驟 2：Position Embedding 查找</h2>

            <div class="step-box">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <span class="step-number">2</span>
                    <span class="step-title">根據位置選擇向量</span>
                </div>
                <p>因為我們正在處理第 4 個位置的 token B（t = 3，從 0 開始計數），<br>
                我們將取 <strong>position embedding 矩陣</strong>的第 4 列。</p>
            </div>

            <div class="matrix-box">
                <div class="matrix-title">Position Embedding 查找過程</div>
                <div class="code-visualization">
                    <pre><span class="code-comment"># Position Embedding Matrix: [Max_Seq_Length × C] = [6 × 48]</span>

位置     選擇哪一列
───────────────────────────────
  0      第 1 列（索引 0）
  1      第 2 列（索引 1）
  2      第 3 列（索引 2）
  <span class="code-keyword">3</span>      <span class="code-keyword">第 4 列（索引 3）</span> ← 我們要的！
  4      第 5 列（索引 4）
  5      第 6 列（索引 5）

<span class="code-comment"># 結果：也是一個長度為 C = 48 的列向量</span>
Position Embedding = <span class="code-keyword">[第 4 列的 48 個浮點數]</span></pre>
                </div>
            </div>

            <div class="pull-quote">
                這同樣產生一個大小為 C = 48 的列向量，<br>
                我們稱之為 <strong>position embedding</strong>。
            </div>

            <div class="info-box">
                <div class="info-box-title">
                    <span>🔵</span>
                    <span>學習參數（Learned Parameters）</span>
                </div>
                <p>注意，這兩個 embedding 矩陣（position 和 token）都是在<strong>訓練期間學習</strong>的。</p>
                <p>（在視覺化中用藍色表示它們是可學習的參數）</p>
            </div>

            <h2>📍 步驟 3：向量相加</h2>

            <div class="step-box">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <span class="step-number">3</span>
                    <span class="step-title">將兩個向量相加</span>
                </div>
                <p>現在我們有了這兩個列向量，我們只需要將它們<strong>相加</strong>，<br>
                就能產生另一個大小為 C = 48 的列向量。</p>
            </div>

            <div class="code-visualization">
                <pre><span class="code-comment"># 向量相加（逐元素相加）</span>

Token Embedding      <span class="code-keyword">+</span>    Position Embedding    <span class="code-keyword">=</span>    Input Embedding
[48 個浮點數]        <span class="code-keyword">+</span>    [48 個浮點數]         <span class="code-keyword">=</span>    [48 個浮點數]

<span class="code-comment"># 舉例（只顯示前 5 個維度）：</span>
[<span class="code-number">0.234</span>, <span class="code-number">-0.512</span>, <span class="code-number">0.823</span>, ...]  <span class="code-keyword">+</span>
[<span class="code-number">0.100</span>, <span class="code-number">0.050</span>, <span class="code-number">-0.023</span>, ...]  <span class="code-keyword">=</span>
[<span class="code-number">0.334</span>, <span class="code-number">-0.462</span>, <span class="code-number">0.800</span>, ...]</pre>
            </div>

            <h2>📍 步驟 4：對所有 Tokens 重複此過程</h2>

            <div class="step-box">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <span class="step-number">4</span>
                    <span class="step-title">生成完整的 Input Embedding 矩陣</span>
                </div>
                <p>我們對輸入序列中的所有 tokens 執行相同的過程，<br>
                創建一組既包含 token 值又包含位置資訊的向量。</p>
            </div>

            <div class="matrix-box">
                <div class="matrix-title">完整的 Input Embedding 矩陣</div>
                <div class="code-visualization">
                    <pre><span class="code-comment"># 輸入序列：C B A B B C (6 個 tokens)</span>

Position   Token   Token_Emb   +   Position_Emb   =   Input_Emb
────────────────────────────────────────────────────────────────
   0         C      [48維]     +     [48維]        =    [48維]
   1         B      [48維]     +     [48維]        =    [48維]
   2         A      [48維]     +     [48維]        =    [48維]
   3         B      [48維]     +     [48維]        =    [48維]  ← 我們剛剛的例子
   4         B      [48維]     +     [48維]        =    [48維]
   5         C      [48維]     +     [48維]        =    [48維]

<span class="code-comment"># 最終結果：Input Embedding Matrix</span>
<span class="code-comment"># 形狀：[T × C] = [6 × 48]</span></pre>
                </div>
            </div>

            <h2>🎯 矩陣維度的含義</h2>

            <p>對輸入序列中的所有 tokens 執行這個過程後，會產生一個大小為 <strong>T × C</strong> 的矩陣。</p>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <div class="card-title">📊 T (Time)</div>
                    <p><strong>T = 6</strong></p>
                    <p>序列長度（有多少個 tokens）</p>
                    <p style="color: #666; font-size: 0.9rem;">你可以把序列中後面的 tokens 想像成「時間上較晚」</p>
                </div>

                <div class="comparison-card">
                    <div class="card-title">📊 C (Channel)</div>
                    <p><strong>C = 48</strong></p>
                    <p>向量長度（每個 token 的維度）</p>
                    <p style="color: #666; font-size: 0.9rem;">也稱為「feature」、「dimension」或「embedding size」</p>
                </div>

                <div class="comparison-card">
                    <div class="card-title">🎛️ 超參數</div>
                    <p><strong>C 是可調的</strong></p>
                    <p>模型設計者選擇的參數</p>
                    <p style="color: #666; font-size: 0.9rem;">在模型大小和性能之間做權衡</p>
                </div>
            </div>

            <div class="pull-quote">
                這個矩陣，我們稱之為 <strong>input embedding</strong>，<br>
                現在已經準備好傳遞到模型的下一層了。<br><br>
                這個由 T 個列向量（每個長度為 C）組成的集合，<br>
                將成為貫穿整個教學的熟悉景象。
            </div>

            <h2>💡 關鍵理解</h2>

            <div class="info-box" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%); border-color: var(--gold);">
                <div class="info-box-title" style="color: var(--gold);">
                    <span>🔑</span>
                    <span>重要概念總結</span>
                </div>
                <ol style="margin-left: 20px; line-height: 2;">
                    <li><strong>整數出現唯一一次</strong>：Token 索引是整數，之後全是浮點數</li>
                    <li><strong>兩個 Embedding 矩陣</strong>：Token Embedding 和 Position Embedding 都是訓練學習得到的</li>
                    <li><strong>簡單相加</strong>：不是拼接，是逐元素相加</li>
                    <li><strong>保留兩種資訊</strong>：既知道「是什麼字」（token），也知道「在哪個位置」（position）</li>
                    <li><strong>統一維度</strong>：所有向量都是 C 維，方便後續計算</li>
                </ol>
            </div>

            <h2>🎓 nano-gpt 的具體數值</h2>

            <div class="matrix-box">
                <div class="code-visualization">
                    <pre><span class="code-comment"># nano-gpt 模型配置</span>

總參數數量：<span class="code-number">85,584</span>

<span class="code-comment"># Embedding 相關參數</span>
詞彙表大小（Vocab Size）：<span class="code-number">3</span> 種 tokens (A, B, C)
序列長度（T）：<span class="code-number">6</span> 個 tokens
向量維度（C）：<span class="code-number">48</span>

<span class="code-comment"># Embedding 矩陣大小</span>
Token Embedding：  [<span class="code-number">3</span> × <span class="code-number">48</span>] = <span class="code-number">144</span> 個參數
Position Embedding：[<span class="code-number">6</span> × <span class="code-number">48</span>] = <span class="code-number">288</span> 個參數

<span class="code-comment"># Input Embedding（不是參數，是計算結果）</span>
Input Embedding：  [<span class="code-number">6</span> × <span class="code-number">48</span>] = 每次推理時動態計算</pre>
                </div>
            </div>

            <h2>🔍 互動探索</h2>

            <div class="info-box" style="background: linear-gradient(135deg, rgba(0, 255, 65, 0.1) 0%, rgba(0, 255, 65, 0.05) 100%); border-color: var(--matrix-green);">
                <div class="info-box-title" style="color: var(--matrix-green);">
                    <span>👆</span>
                    <span>互動提示（原網站功能）</span>
                </div>
                <p>在原始的 <a href="https://bbycroft.net/llm" target="_blank" style="color: var(--matrix-green);">bbycroft.net/llm</a> 網站上，你可以：</p>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li>將滑鼠懸停在 input embedding 矩陣的單個格子上</li>
                    <li>查看該格子的計算過程和來源</li>
                    <li>看到 token embedding 和 position embedding 如何相加</li>
                </ul>
            </div>

            <h2>🎬 下一步</h2>

            <p>現在我們有了 Input Embedding 矩陣 [6 × 48]，接下來：</p>
            
            <div class="comparison-grid">
                <div class="comparison-card" style="border-top-color: var(--purple);">
                    <div class="card-title">→ 第二章</div>
                    <p><strong>Self-Attention</strong></p>
                    <p>這個矩陣將進入 Transformer 的核心機制</p>
                </div>

                <div class="comparison-card" style="border-top-color: var(--purple);">
                    <div class="card-title">→ 第三章</div>
                    <p><strong>Multi-Head Attention</strong></p>
                    <p>平行處理多個注意力視角</p>
                </div>

                <div class="comparison-card" style="border-top-color: var(--purple);">
                    <div class="card-title">→ 第四章</div>
                    <p><strong>Feed Forward Network</strong></p>
                    <p>每個 token 的獨立處理</p>
                </div>
            </div>

            <h2 style="margin-top: 80px;">🗺️ 回顧架構全貌</h2>

            <div class="info-box" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%); border-color: var(--gold);">
                <div class="info-box-title" style="color: var(--gold);">
                    <span>📍</span>
                    <span>Embedding 在完整架構中的位置</span>
                </div>
                <figure style="margin: 20px 0 0 0;">
                    <img src="../../images/llm_architecture_full_20260105210724.png" alt="LLM 完整架構" style="max-width: 100%; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                    <figcaption style="margin-top: 20px; font-size: 1rem; color: #666; line-height: 1.8;">
                        完整架構圖：我們剛剛完成了最上方的<span style="color: #c71585; font-weight: 700;"> Embedding 層</span>，<br>
                        接下來將進入中間的 <span style="color: #daa520; font-weight: 700;">Transformer Block</span>
                    </figcaption>
                </figure>
                <div style="text-align: center; margin-top: 30px;">
                    <a href="../index.html" style="display: inline-block; padding: 15px 40px; background: var(--gold); color: #0a0e27; text-decoration: none; border-radius: 50px; font-weight: 700; transition: transform 0.3s ease;">
                        ← 返回教學首頁查看所有章節
                    </a>
                </div>
            </div>

        </div>
    </div>

    <!-- Chapter Navigation -->
    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 60px 40px; margin-top: 80px;">
        <div style="max-width: 900px; margin: 0 auto;">
            
            <h2 style="font-family: 'Noto Serif TC', serif; font-size: 2rem; color: #0a0e27; text-align: center; margin-bottom: 40px; border: none; padding: 0;">
                🎯 本章重點回顧
            </h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 50px;">
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 2rem; margin-bottom: 10px;">📝</div>
                    <div style="font-weight: 700; color: #0a0e27; margin-bottom: 8px;">Token → Integer</div>
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.6;">透過 Lookup Table 將文字轉換為整數索引</div>
                </div>

                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 2rem; margin-bottom: 10px;">🔢</div>
                    <div style="font-weight: 700; color: #0a0e27; margin-bottom: 8px;">Token Embedding</div>
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.6;">將整數映射到 48 維向量空間</div>
                </div>

                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 2rem; margin-bottom: 10px;">📍</div>
                    <div style="font-weight: 700; color: #0a0e27; margin-bottom: 8px;">Position Embedding</div>
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.6;">加入位置資訊，讓模型理解順序</div>
                </div>

                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <div style="font-size: 2rem; margin-bottom: 10px;">➕</div>
                    <div style="font-weight: 700; color: #0a0e27; margin-bottom: 8px;">Input Embedding</div>
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.6;">Token + Position = [6 × 48] 矩陣</div>
                </div>
            </div>

            <div style="border-top: 2px solid #dee2e6; padding-top: 40px; margin-top: 40px;">
                <h3 style="font-family: 'Noto Serif TC', serif; font-size: 1.5rem; color: #0a0e27; text-align: center; margin-bottom: 30px;">
                    📚 章節導航
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <a href="../index.html" style="display: flex; align-items: center; gap: 15px; padding: 25px; background: white; border-radius: 15px; text-decoration: none; color: #0a0e27; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <div style="font-size: 2rem;">⬅️</div>
                        <div>
                            <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">返回</div>
                            <div style="font-weight: 700; font-size: 1.1rem;">教學首頁</div>
                        </div>
                    </a>

                    <a href="02-layer-normalization.html" style="display: flex; align-items: center; justify-content: flex-end; gap: 15px; padding: 25px; background: linear-gradient(135deg, #ffd700 0%, #f0c000 100%); border-radius: 15px; text-decoration: none; color: #0a0e27; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                        <div style="text-align: right;">
                            <div style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 5px;">下一章</div>
                            <div style="font-weight: 700; font-size: 1.1rem;">Layer Normalization</div>
                            <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 5px;">正規化輸入，準備進入 Transformer</div>
                        </div>
                        <div style="font-size: 2rem;">➡️</div>
                    </a>
                </div>

                <div style="text-align: center; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 12px; border: 2px dashed var(--gold);">
                    <div style="font-size: 0.95rem; color: #666; line-height: 1.8;">
                        <strong style="color: #0a0e27;">💡 下一步學什麼？</strong><br>
                        Embedding 產生了 [6 × 48] 矩陣，但在進入 Transformer Block 之前，<br>
                        需要先經過 <strong style="color: var(--gold);">Layer Normalization</strong> 來穩定數值範圍。<br>
                        這是深度神經網絡訓練的關鍵技術！
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer Quote -->
    <div class="footer-quote">
        <p class="footer-quote-text">
            「從整數到浮點數，從 token 到向量，<br>
            這是神經網絡理解語言的第一步。」
        </p>
        <p class="footer-quote-author">— LLM 視覺化教學 · 2026</p>
    </div>

</body>
</html>

